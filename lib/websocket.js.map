{"version":3,"sources":["../src/websocket.js"],"names":["WSSource","url","options","socket","callbacks","connect","data","destination","reconnectInterval","undefined","shouldAttemptReconnect","completed","established","progress","reconnectTimeoutId","prototype","destroy","clearTimeout","close","start","WebSocket","protocols","binaryType","onmessage","onMessage","bind","onopen","onOpen","onerror","onClose","onclose","resume","secondsHeadroom","setTimeout","ev","write"],"mappings":"AAAA,IAAIA,WAAW,SAAXA,QAAW,CAASC,GAAT,EAAcC,OAAd,EAAuB;AACrC,MAAKD,GAAL,GAAWA,GAAX;AACA,MAAKC,OAAL,GAAeA,OAAf;AACA,MAAKC,MAAL,GAAc,IAAd;;AAEA,MAAKC,SAAL,GAAiB,EAACC,SAAS,EAAV,EAAcC,MAAM,EAApB,EAAjB;AACA,MAAKC,WAAL,GAAmB,IAAnB;;AAEA,MAAKC,iBAAL,GAAyBN,QAAQM,iBAAR,KAA8BC,SAA9B,GACtBP,QAAQM,iBADc,GAEtB,CAFH;AAGA,MAAKE,sBAAL,GAA8B,CAAC,CAAC,KAAKF,iBAArC;;AAEA,MAAKG,SAAL,GAAiB,KAAjB;AACA,MAAKC,WAAL,GAAmB,KAAnB;AACA,MAAKC,QAAL,GAAgB,CAAhB;;AAEA,MAAKC,kBAAL,GAA0B,CAA1B;AACA,CAlBD;;AAoBAd,SAASe,SAAT,CAAmBV,OAAnB,GAA6B,UAASE,WAAT,EAAsB;AAClD,MAAKA,WAAL,GAAmBA,WAAnB;AACA,CAFD;;AAIAP,SAASe,SAAT,CAAmBC,OAAnB,GAA6B,YAAW;AACvCC,cAAa,KAAKH,kBAAlB;AACA,MAAKJ,sBAAL,GAA8B,KAA9B;AACA,MAAKP,MAAL,CAAYe,KAAZ;AACA,CAJD;;AAMAlB,SAASe,SAAT,CAAmBI,KAAnB,GAA2B,YAAW;AACrC,MAAKT,sBAAL,GAA8B,CAAC,CAAC,KAAKF,iBAArC;AACA,MAAKK,QAAL,GAAgB,CAAhB;AACA,MAAKD,WAAL,GAAmB,KAAnB;;AAEA,MAAKT,MAAL,GAAc,IAAIiB,SAAJ,CAAc,KAAKnB,GAAnB,EAAwB,KAAKC,OAAL,CAAamB,SAAb,IAA0B,IAAlD,CAAd;AACA,MAAKlB,MAAL,CAAYmB,UAAZ,GAAyB,aAAzB;AACA,MAAKnB,MAAL,CAAYoB,SAAZ,GAAwB,KAAKC,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAAxB;AACA,MAAKtB,MAAL,CAAYuB,MAAZ,GAAqB,KAAKC,MAAL,CAAYF,IAAZ,CAAiB,IAAjB,CAArB;AACA,MAAKtB,MAAL,CAAYyB,OAAZ,GAAsB,KAAKC,OAAL,CAAaJ,IAAb,CAAkB,IAAlB,CAAtB;AACA,MAAKtB,MAAL,CAAY2B,OAAZ,GAAsB,KAAKD,OAAL,CAAaJ,IAAb,CAAkB,IAAlB,CAAtB;AACA,CAXD;;AAaAzB,SAASe,SAAT,CAAmBgB,MAAnB,GAA4B,UAASC,eAAT,EAA0B;AACrD;AACA,CAFD;;AAIAhC,SAASe,SAAT,CAAmBY,MAAnB,GAA4B,YAAW;AACtC,MAAKd,QAAL,GAAgB,CAAhB;AACA,MAAKD,WAAL,GAAmB,IAAnB;AACA,CAHD;;AAKAZ,SAASe,SAAT,CAAmBc,OAAnB,GAA6B,YAAW;AACvC,KAAI,KAAKnB,sBAAT,EAAiC;AAChCO,eAAa,KAAKH,kBAAlB;AACA,OAAKA,kBAAL,GAA0BmB,WAAW,YAAU;AAC9C,QAAKd,KAAL;AACA,GAFoC,CAEnCM,IAFmC,CAE9B,IAF8B,CAAX,EAEZ,KAAKjB,iBAAL,GAAuB,IAFX,CAA1B;AAGA;AACD,CAPD;;AASAR,SAASe,SAAT,CAAmBS,SAAnB,GAA+B,UAASU,EAAT,EAAa;AAC3C,KAAI,KAAK3B,WAAT,EAAsB;AACrB,OAAKA,WAAL,CAAiB4B,KAAjB,CAAuBD,GAAG5B,IAA1B;AACA;AACD,CAJD;;AAMA,eAAeN,QAAf","file":"websocket.js","sourcesContent":["let WSSource = function(url, options) {\n\tthis.url = url;\n\tthis.options = options;\n\tthis.socket = null;\t\n\n\tthis.callbacks = {connect: [], data: []};\n\tthis.destination = null;\n\n\tthis.reconnectInterval = options.reconnectInterval !== undefined\n\t\t? options.reconnectInterval\n\t\t: 5;\n\tthis.shouldAttemptReconnect = !!this.reconnectInterval;\n\n\tthis.completed = false;\n\tthis.established = false;\n\tthis.progress = 0;\n\n\tthis.reconnectTimeoutId = 0;\n};\n\nWSSource.prototype.connect = function(destination) {\n\tthis.destination = destination;\n};\n\nWSSource.prototype.destroy = function() {\n\tclearTimeout(this.reconnectTimeoutId);\n\tthis.shouldAttemptReconnect = false;\n\tthis.socket.close();\n};\n\nWSSource.prototype.start = function() {\n\tthis.shouldAttemptReconnect = !!this.reconnectInterval;\n\tthis.progress = 0;\n\tthis.established = false;\n\t\n\tthis.socket = new WebSocket(this.url, this.options.protocols || null);\n\tthis.socket.binaryType = 'arraybuffer';\n\tthis.socket.onmessage = this.onMessage.bind(this);\n\tthis.socket.onopen = this.onOpen.bind(this);\n\tthis.socket.onerror = this.onClose.bind(this);\n\tthis.socket.onclose = this.onClose.bind(this);\n};\n\nWSSource.prototype.resume = function(secondsHeadroom) {\n\t// Nothing to do here\n};\n\nWSSource.prototype.onOpen = function() {\n\tthis.progress = 1;\n\tthis.established = true;\n};\n\nWSSource.prototype.onClose = function() {\n\tif (this.shouldAttemptReconnect) {\n\t\tclearTimeout(this.reconnectTimeoutId);\n\t\tthis.reconnectTimeoutId = setTimeout(function(){\n\t\t\tthis.start();\t\n\t\t}.bind(this), this.reconnectInterval*1000);\n\t}\n};\n\nWSSource.prototype.onMessage = function(ev) {\n\tif (this.destination) {\n\t\tthis.destination.write(ev.data);\n\t}\n};\n\nexport default WSSource;\n\n"]}