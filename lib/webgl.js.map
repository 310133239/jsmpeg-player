{"version":3,"sources":["../src/webgl.js"],"names":["WebGLRenderer","options","canvas","document","createElement","width","height","enabled","contextCreateOptions","preserveDrawingBuffer","alpha","depth","stencil","antialias","gl","getContext","Error","vertexAttr","vertexBuffer","createBuffer","vertexCoords","Float32Array","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","program","createProgram","SHADER","VERTEX_IDENTITY","FRAGMENT_YCRCB_TO_RGBA","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","textureY","createTexture","textureCb","textureCr","loadingProgram","FRAGMENT_LOADING","shouldCreateUnclampedViews","allowsClampedTextureData","prototype","destroy","deleteTexture","deleteProgram","deleteBuffer","resize","useProgram","viewport","index","name","texture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","uniform1i","getUniformLocation","vsh","fsh","attachShader","compileShader","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","type","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","texImage2D","LUMINANCE","UNSIGNED_BYTE","Uint8ClampedArray","getError","renderProgress","progress","loc","uniform1f","drawArrays","TRIANGLE_STRIP","render","y","cb","cr","w","h","w2","h2","Uint8Array","buffer","updateTexture","TEXTURE0","TEXTURE1","TEXTURE2","unit","data","activeTexture","IsSupported","window","WebGLRenderingContext","err","join"],"mappings":"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","file":"webgl.js","sourcesContent":["let WebGLRenderer = function(options) {\r\n\tthis.canvas = options.canvas || document.createElement('canvas');\r\n\tthis.width = this.canvas.width;\r\n\tthis.height = this.canvas.height;\r\n\tthis.enabled = true;\r\n\r\n\tvar contextCreateOptions = {\r\n\t\tpreserveDrawingBuffer: !!options.preserveDrawingBuffer,\r\n\t\talpha: false,\r\n\t\tdepth: false,\r\n\t\tstencil: false,\r\n\t\tantialias: false\r\n\t};\r\n\r\n\tthis.gl = \r\n\t\tthis.canvas.getContext('webgl', contextCreateOptions) || \r\n\t\tthis.canvas.getContext('experimental-webgl', contextCreateOptions);\r\n\r\n\tif (!this.gl) {\r\n\t\tthrow new Error('Failed to get WebGL Context');\r\n\t}\r\n\r\n\tvar gl = this.gl;\r\n\tvar vertexAttr = null;\r\n\r\n\t// Init buffers\r\n\tthis.vertexBuffer = gl.createBuffer();\r\n\tvar vertexCoords = new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]);\r\n\tgl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\r\n\tgl.bufferData(gl.ARRAY_BUFFER, vertexCoords, gl.STATIC_DRAW);\r\n\r\n\t// Setup the main YCrCbToRGBA shader\r\n\tthis.program = this.createProgram(\r\n\t\tWebGLRenderer.SHADER.VERTEX_IDENTITY,\r\n\t\tWebGLRenderer.SHADER.FRAGMENT_YCRCB_TO_RGBA\r\n\t);\r\n\tvertexAttr = gl.getAttribLocation(this.program, 'vertex');\r\n\tgl.enableVertexAttribArray(vertexAttr);\r\n\tgl.vertexAttribPointer(vertexAttr, 2, gl.FLOAT, false, 0, 0);\r\n\r\n\tthis.textureY = this.createTexture(0, 'textureY');\r\n\tthis.textureCb = this.createTexture(1, 'textureCb');\r\n\tthis.textureCr = this.createTexture(2, 'textureCr');\r\n\r\n\r\n\t// Setup the loading animation shader\r\n\tthis.loadingProgram = this.createProgram(\r\n\t\tWebGLRenderer.SHADER.VERTEX_IDENTITY,\r\n\t\tWebGLRenderer.SHADER.FRAGMENT_LOADING\r\n\t);\r\n\tvertexAttr = gl.getAttribLocation(this.loadingProgram, 'vertex');\r\n\tgl.enableVertexAttribArray(vertexAttr);\r\n\tgl.vertexAttribPointer(vertexAttr, 2, gl.FLOAT, false, 0, 0);\r\n\r\n\tthis.shouldCreateUnclampedViews = !this.allowsClampedTextureData();\r\n};\r\n\r\nWebGLRenderer.prototype.destroy = function() {\r\n\tvar gl = this.gl;\r\n\t\r\n\tgl.deleteTexture(this.textureY);\r\n\tgl.deleteTexture(this.textureCb);\r\n\tgl.deleteTexture(this.textureCr);\r\n\r\n\tgl.deleteProgram(this.program);\r\n\tgl.deleteProgram(this.loadingProgram);\r\n\r\n\tgl.deleteBuffer(this.vertexBuffer);\r\n};\r\n\r\nWebGLRenderer.prototype.resize = function(width, height) {\r\n\tthis.width = width|0;\r\n\tthis.height = height|0;\r\n\r\n\tthis.canvas.width = this.width;\r\n\tthis.canvas.height = this.height;\r\n\r\n\tthis.gl.useProgram(this.program);\r\n\tthis.gl.viewport(0, 0, this.width, this.height);\r\n};\r\n\r\nWebGLRenderer.prototype.createTexture = function(index, name) {\r\n\tvar gl = this.gl;\r\n\tvar texture = gl.createTexture();\r\n\r\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\tgl.uniform1i(gl.getUniformLocation(this.program, name), index);\r\n\r\n\treturn texture;\r\n};\r\n\r\nWebGLRenderer.prototype.createProgram = function(vsh, fsh) {\r\n\tvar gl = this.gl;\r\n\tvar program = gl.createProgram();\r\n\r\n\tgl.attachShader(program, this.compileShader(gl.VERTEX_SHADER, vsh));\r\n\tgl.attachShader(program, this.compileShader(gl.FRAGMENT_SHADER, fsh));\r\n\tgl.linkProgram(program);\r\n\tgl.useProgram(program);\r\n\r\n\treturn program;\r\n};\r\n\r\nWebGLRenderer.prototype.compileShader = function(type, source) {\r\n\tvar gl = this.gl;\r\n\tvar shader = gl.createShader(type);\r\n\tgl.shaderSource(shader, source);\r\n\tgl.compileShader(shader);\r\n\r\n\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n\t\tthrow new Error(gl.getShaderInfoLog(shader));\r\n\t}\r\n\r\n\treturn shader;\r\n};\r\n\r\nWebGLRenderer.prototype.allowsClampedTextureData = function() {\r\n\tvar gl = this.gl;\r\n\tvar texture = gl.createTexture();\r\n\r\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\r\n\tgl.texImage2D(\r\n\t\tgl.TEXTURE_2D, 0, gl.LUMINANCE, 1, 1, 0,\r\n\t\tgl.LUMINANCE, gl.UNSIGNED_BYTE, new Uint8ClampedArray([0])\r\n\t);\r\n\treturn (gl.getError() === 0);\r\n};\r\n\r\nWebGLRenderer.prototype.renderProgress = function(progress) {\r\n\tvar gl = this.gl;\r\n\r\n\tgl.useProgram(this.loadingProgram);\r\n\r\n\tvar loc = gl.getUniformLocation(this.loadingProgram, 'progress');\r\n\tgl.uniform1f(loc, progress);\r\n\t\r\n\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n};\r\n\r\nWebGLRenderer.prototype.render = function(y, cb, cr) {\r\n\tif (!this.enabled) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar gl = this.gl;\r\n\tvar w = ((this.width + 15) >> 4) << 4,\r\n\t\th = this.height,\r\n\t\tw2 = w >> 1,\r\n\t\th2 = h >> 1;\r\n\r\n\t// In some browsers WebGL doesn't like Uint8ClampedArrays (this is a bug\r\n\t// and should be fixed soon-ish), so we have to create a Uint8Array view \r\n\t// for each plane.\r\n\tif (this.shouldCreateUnclampedViews) {\r\n\t\ty = new Uint8Array(y.buffer),\r\n\t\tcb = new Uint8Array(cb.buffer),\r\n\t\tcr = new Uint8Array(cr.buffer);\t\r\n\t}\r\n\r\n\tgl.useProgram(this.program);\r\n\r\n\tthis.updateTexture(gl.TEXTURE0, this.textureY, w, h, y);\r\n\tthis.updateTexture(gl.TEXTURE1, this.textureCb, w2, h2, cb);\r\n\tthis.updateTexture(gl.TEXTURE2, this.textureCr, w2, h2, cr);\r\n\r\n\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n};\r\n\r\nWebGLRenderer.prototype.updateTexture = function(unit, texture, w, h, data) {\r\n\tvar gl = this.gl;\r\n\tgl.activeTexture(unit);\r\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\r\n\tgl.texImage2D(\r\n\t\tgl.TEXTURE_2D, 0, gl.LUMINANCE, w, h, 0, \r\n\t\tgl.LUMINANCE, gl.UNSIGNED_BYTE, data\r\n\t);\r\n}\r\n\r\nWebGLRenderer.IsSupported = function() {\r\n\ttry {\r\n\t\tif (!window.WebGLRenderingContext) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar canvas = document.createElement('canvas'); \r\n\t\treturn !!(\r\n\t\t\tcanvas.getContext('webgl') || \r\n\t\t\tcanvas.getContext('experimental-webgl')\r\n\t\t);\r\n\t}\r\n\tcatch (err) {\r\n\t\treturn false;\r\n\t} \r\n};\r\n\r\nWebGLRenderer.SHADER = {\r\n\tFRAGMENT_YCRCB_TO_RGBA: [\r\n\t\t'precision mediump float;',\r\n\t\t'uniform sampler2D textureY;',\r\n\t\t'uniform sampler2D textureCb;',\r\n\t\t'uniform sampler2D textureCr;',\r\n\t\t'varying vec2 texCoord;',\r\n\r\n\t\t'mat4 rec601 = mat4(',\r\n\t\t\t'1.16438,  0.00000,  1.59603, -0.87079,',\r\n\t\t\t'1.16438, -0.39176, -0.81297,  0.52959,',\r\n\t\t\t'1.16438,  2.01723,  0.00000, -1.08139,',\r\n\t\t\t'0, 0, 0, 1',\r\n\t\t');',\r\n\r\n\t\t'void main() {',\r\n\t\t\t'float y = texture2D(textureY, texCoord).r;',\r\n\t\t\t'float cb = texture2D(textureCb, texCoord).r;',\r\n\t\t\t'float cr = texture2D(textureCr, texCoord).r;',\r\n\r\n\t\t\t'gl_FragColor = vec4(y, cr, cb, 1.0) * rec601;',\r\n\t\t'}'\r\n\t].join('\\n'),\r\n\r\n\tFRAGMENT_LOADING: [\r\n\t\t'precision mediump float;',\r\n\t\t'uniform float progress;',\r\n\t\t'varying vec2 texCoord;',\r\n\r\n\t\t'void main() {',\r\n\t\t\t'float c = ceil(progress-(1.0-texCoord.y));',\r\n\t\t\t'gl_FragColor = vec4(c,c,c,1);',\r\n\t\t'}'\r\n\t].join('\\n'),\r\n\r\n\tVERTEX_IDENTITY: [\r\n\t\t'attribute vec2 vertex;',\r\n\t\t'varying vec2 texCoord;',\r\n\r\n\t\t'void main() {',\r\n\t\t\t'texCoord = vertex;',\r\n\t\t\t'gl_Position = vec4((vertex * 2.0 - 1.0) * vec2(1, -1), 0.0, 1.0);',\r\n\t\t'}'\r\n\t].join('\\n')\r\n};\r\n\r\nexport default WebGLRenderer;\r\n"]}