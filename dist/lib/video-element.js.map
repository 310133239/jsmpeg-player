{"version":3,"sources":["../../src/lib/video-element.js"],"names":["Player","VideoElement","wrapper","videoUrl","options","addStyles","element","styles","name","style","container","document","createElement","position","width","minWidth","height","paddingBottom","aspectPercent","appendChild","setWrapperHeight","offsetHeight","window","addEventListener","canvas","top","left","display","playButton","innerHTML","PLAY_BUTTON","zIndex","bottom","right","maxWidth","maxHeight","margin","opacity","cursor","picMode","visibility","PlayerOptions","Object","assign","player","play","poster","hookInPlay","pause","hookInPause","stop","hookInStop","playerInstance","autoplay","streaming","decodeFirstFrame","Image","src","posterLoaded","onClick","bind","audioOut","unlocked","unlockAudioElement","unmuteButton","UNMUTE_BUTTON","unlockAudioBound","onUnlockAudio","prototype","ev","preventDefault","stopPropagation","unlock","removeEventListener","isPlaying","destroy"],"mappings":"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","file":"video-element.js","sourcesContent":["import Player from './player';\r\n\r\nlet VideoElement = function (wrapper, videoUrl, options) {\r\n  // Setup the div container, canvas and play button\r\n  var addStyles = function (element, styles) {\r\n    for (var name in styles) {\r\n      element.style[name] = styles[name];\r\n    }\r\n  };\r\n\r\n  this.wrapper = wrapper;\r\n\r\n  this.container = document.createElement('div');\r\n  addStyles(this.container, {\r\n    position: 'relative',\r\n    width: '100%',\r\n    minWidth: '80px',\r\n    height: '0',\r\n    paddingBottom: options.aspectPercent || '56.25%',\r\n  });\r\n  this.wrapper.appendChild(this.container);\r\n\r\n  // 赋值wrapper高度，防止销毁时页面抖动\r\n  this.setWrapperHeight = () => {\r\n    this.wrapper.style.height = this.container.offsetHeight + 'px';\r\n  };\r\n  this.setWrapperHeight();\r\n  window.addEventListener('resize', this.setWrapperHeight);\r\n\r\n  this.canvas = document.createElement('canvas');\r\n  addStyles(this.canvas, {\r\n    position: 'absolute',\r\n    top: '0',\r\n    left: '0',\r\n    display: 'block',\r\n    width: '100%',\r\n    height: '100%',\r\n  });\r\n  this.container.appendChild(this.canvas);\r\n\r\n  this.playButton = document.createElement('div');\r\n  this.playButton.innerHTML = VideoElement.PLAY_BUTTON;\r\n  addStyles(this.playButton, {\r\n    zIndex: 2, position: 'absolute',\r\n    top: '0', bottom: '0', left: '0', right: '0',\r\n    maxWidth: '60px', maxHeight: '60px',\r\n    margin: 'auto',\r\n    opacity: '0.7',\r\n    cursor: 'pointer'\r\n  });\r\n  if (options.picMode) {\r\n    this.playButton.style.visibility = 'hidden';\r\n  }\r\n\r\n  this.container.appendChild(this.playButton);\r\n\r\n  // Parse the data-options - we try to decode the values as json. This way\r\n  // we can get proper boolean and number values. If JSON.parse() fails,\r\n  // treat it as a string.\r\n  let PlayerOptions = Object.assign(options, {\r\n    canvas: this.canvas,\r\n  });\r\n\r\n  // Create the player instance\r\n  this.player = new Player(videoUrl, PlayerOptions, {\r\n    play: () => {\r\n      this.playButton.style.display = 'none';\r\n      if (this.poster) {\r\n        this.poster.style.display = 'none';\r\n      }\r\n      if (options.hookInPlay) {\r\n        options.hookInPlay();\r\n      }\r\n    },\r\n    pause: () => {\r\n      this.playButton.style.display = 'block';\r\n      if (options.hookInPause) {\r\n        options.hookInPause();\r\n      }\r\n    },\r\n    stop: () => {\r\n      if (this.poster) {\r\n        this.poster.style.display = 'block';\r\n      }\r\n      if (options.hookInStop) {\r\n        options.hookInStop();\r\n      }\r\n    },\r\n  });\r\n\r\n  wrapper.playerInstance = this.player;\r\n\r\n  // Setup the poster element, if any\r\n  if (options.poster && !options.autoplay && !this.player.options.streaming) {\r\n    options.decodeFirstFrame = false;\r\n    this.poster = new Image();\r\n    this.poster.src = options.poster;\r\n    this.poster.addEventListener('load', this.posterLoaded);\r\n    addStyles(this.poster, {\r\n      display: 'block', zIndex: 1, position: 'absolute',\r\n      top: '0', left: '0', width: '100%', height: '100%',\r\n    });\r\n    this.container.appendChild(this.poster);\r\n  }\r\n\r\n  // Add the click handler if this video is pausable\r\n  if (!this.player.options.streaming) {\r\n    this.container.addEventListener('click', this.onClick.bind(this));\r\n  }\r\n\r\n  // Hide the play button if this video immediately begins playing\r\n  if (options.autoplay || this.player.options.streaming) {\r\n    this.playButton.style.display = 'none';\r\n  }\r\n\r\n  // Set up the unlock audio buton for iOS devices. iOS only allows us to\r\n  // play audio after a user action has initiated playing. For autoplay or\r\n  // streaming players we set up a muted speaker icon as the button. For all\r\n  // others, we can simply use the play button.\r\n  if (this.player.audioOut && !this.player.audioOut.unlocked) {\r\n    var unlockAudioElement = this.container;\r\n\r\n    if (options.autoplay || this.player.options.streaming) {\r\n      this.unmuteButton = document.createElement('div');\r\n      this.unmuteButton.innerHTML = VideoElement.UNMUTE_BUTTON;\r\n      addStyles(this.unmuteButton, {\r\n        zIndex: 2, position: 'absolute',\r\n        top: '0', left: '0',\r\n        width: '100%', height: '100%',\r\n        opacity: '0.7',\r\n        cursor: 'pointer'\r\n      });\r\n      this.container.appendChild(this.unmuteButton);\r\n      unlockAudioElement = this.unmuteButton;\r\n    }\r\n\r\n    this.unlockAudioBound = this.onUnlockAudio.bind(this, unlockAudioElement);\r\n    unlockAudioElement.addEventListener('touchstart', this.unlockAudioBound, false);\r\n    unlockAudioElement.addEventListener('click', this.unlockAudioBound, true);\r\n  }\r\n};\r\n\r\nVideoElement.prototype.onUnlockAudio = function (element, ev) {\r\n  if (this.unmuteButton) {\r\n    ev.preventDefault();\r\n    ev.stopPropagation();\r\n  }\r\n  this.player.audioOut.unlock(function () {\r\n    if (this.unmuteButton) {\r\n      this.unmuteButton.style.display = 'none';\r\n    }\r\n    element.removeEventListener('touchstart', this.unlockAudioBound);\r\n    element.removeEventListener('click', this.unlockAudioBound);\r\n  }.bind(this));\r\n};\r\n\r\nVideoElement.prototype.onClick = function (ev) {\r\n  if (this.player.isPlaying) {\r\n    this.player.pause();\r\n  }\r\n  else {\r\n    this.player.play();\r\n  }\r\n};\r\n\r\n// 自定义清理\r\nVideoElement.prototype.destroy = function () {\r\n  this.player.destroy();\r\n  this.wrapper.innerHTML = '';\r\n  window.removeEventListener('resize', this.setWrapperHeight);\r\n};\r\n\r\nVideoElement.PLAY_BUTTON = `\r\n<svg style=\"max-width: 60px; max-height: 60px; fill: #fff;\" viewBox=\"0 0 64 64\">\r\n\t<path d=\"M26,45.5L44,32L26,18.6v27V45.5L26,45.5z M32,2C15.4,2,2,15.5,2,32c0,16.6,13.4,30,30,30c16.6,0,30-13.4,30-30\r\n\tC62,15.4,48.5,2,32,2L32,2z M32,56c-9.7,0-18.5-5.9-22.2-14.8C6.1,32.2,8.1,21.9,15,15c6.9-6.9,17.2-8.9,26.2-5.2\r\n\tC50.1,13.5,56,22.3,56,32C56,45.3,45.2,56,32,56L32,56z\"/>\r\n</svg>\r\n`;\r\n\r\nVideoElement.UNMUTE_BUTTON = `\r\n<svg style=\"position: absolute; bottom: 15px; right: 15px; width: 40px; height: 40px; fill: #fff;\" viewBox=\"0 0 64 64\">\r\n\t<path d=\"M58.3,45.5l-4.8-4.3c1.4-2.9,2.2-6.2,2.2-9.6c0-11.1-8.2-20.3-18.9-21.9V3.3C50.9,4.9,62,16.9,62,31.6\r\n\tC62,36.6,60.6,41.4,58.3,45.5L58.3,45.5z M30.4,5.6v15.2l-8.3-7.3L30.4,5.6L30.4,5.6z M36.7,19.9c4.6,1.9,7.9,6.4,7.9,11.7\r\n\tc0,0.6-0.1,1.1-0.1,1.7l-7.8-6.9V19.9L36.7,19.9z M57.5,60.7l-7.1-6.3c-3.9,2.9-8.6,4.8-13.7,5.4v-6.4c3.2-0.5,6.2-1.7,8.8-3.4\r\n\tl-8.1-7.2c-0.2,0.1-0.5,0.3-0.7,0.4v-1l-6.3-5.6v20.2L15.4,42.6H2V20.5h10.2l-9.7-8.6l4.2-4.7L61.7,56L57.5,60.7L57.5,60.7z\"/>\r\n</svg>\r\n`;\r\nexport default VideoElement;\r\n\r\n"]}