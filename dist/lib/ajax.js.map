{"version":3,"sources":["../../src/lib/ajax.js"],"names":["AjaxSource","url","options","destination","request","completed","established","progress","prototype","connect","start","XMLHttpRequest","onreadystatechange","readyState","DONE","status","onLoad","response","bind","onprogress","onProgress","open","responseType","send","resume","secondsHeadroom","destroy","abort","ev","loaded","total","data","write"],"mappings":"AAAA,IAAIA,aAAa,SAAbA,UAAa,CAASC,GAAT,EAAcC,OAAd,EAAuB;AACvC,MAAKD,GAAL,GAAWA,GAAX;AACA,MAAKE,WAAL,GAAmB,IAAnB;AACA,MAAKC,OAAL,GAAe,IAAf;;AAEA,MAAKC,SAAL,GAAiB,KAAjB;AACA,MAAKC,WAAL,GAAmB,KAAnB;AACA,MAAKC,QAAL,GAAgB,CAAhB;AACA,CARD;;AAUAP,WAAWQ,SAAX,CAAqBC,OAArB,GAA+B,UAASN,WAAT,EAAsB;AACpD,MAAKA,WAAL,GAAmBA,WAAnB;AACA,CAFD;;AAIAH,WAAWQ,SAAX,CAAqBE,KAArB,GAA6B,YAAW;AACvC,MAAKN,OAAL,GAAe,IAAIO,cAAJ,EAAf;;AAEA,MAAKP,OAAL,CAAaQ,kBAAb,GAAkC,YAAW;AAC5C,MACC,KAAKR,OAAL,CAAaS,UAAb,KAA4B,KAAKT,OAAL,CAAaU,IAAzC,IACA,KAAKV,OAAL,CAAaW,MAAb,KAAwB,GAFzB,EAGE;AACD,QAAKC,MAAL,CAAY,KAAKZ,OAAL,CAAaa,QAAzB;AACA;AACD,EAPiC,CAOhCC,IAPgC,CAO3B,IAP2B,CAAlC;;AASA,MAAKd,OAAL,CAAae,UAAb,GAA0B,KAAKC,UAAL,CAAgBF,IAAhB,CAAqB,IAArB,CAA1B;AACA,MAAKd,OAAL,CAAaiB,IAAb,CAAkB,KAAlB,EAAyB,KAAKpB,GAA9B;AACA,MAAKG,OAAL,CAAakB,YAAb,GAA4B,aAA5B;AACA,MAAKlB,OAAL,CAAamB,IAAb;AACA,CAhBD;;AAkBAvB,WAAWQ,SAAX,CAAqBgB,MAArB,GAA8B,UAASC,eAAT,EAA0B;AACvD;AACA,CAFD;;AAIAzB,WAAWQ,SAAX,CAAqBkB,OAArB,GAA+B,YAAW;AACzC,MAAKtB,OAAL,CAAauB,KAAb;AACA,CAFD;;AAIA3B,WAAWQ,SAAX,CAAqBY,UAArB,GAAkC,UAASQ,EAAT,EAAa;AAC9C,MAAKrB,QAAL,GAAiBqB,GAAGC,MAAH,GAAYD,GAAGE,KAAhC;AACA,CAFD;;AAIA9B,WAAWQ,SAAX,CAAqBQ,MAArB,GAA8B,UAASe,IAAT,EAAe;AAC5C,MAAKzB,WAAL,GAAmB,IAAnB;AACA,MAAKD,SAAL,GAAiB,IAAjB;AACA,MAAKE,QAAL,GAAgB,CAAhB;;AAEA,KAAI,KAAKJ,WAAT,EAAsB;AACrB,OAAKA,WAAL,CAAiB6B,KAAjB,CAAuBD,IAAvB;AACA;AACD,CARD;;AAUA,eAAe/B,UAAf","file":"ajax.js","sourcesContent":["let AjaxSource = function(url, options) {\n\tthis.url = url;\n\tthis.destination = null;\n\tthis.request = null;\n\n\tthis.completed = false;\n\tthis.established = false;\n\tthis.progress = 0;\n};\n\nAjaxSource.prototype.connect = function(destination) {\n\tthis.destination = destination;\n};\n\nAjaxSource.prototype.start = function() {\n\tthis.request = new XMLHttpRequest();\n\n\tthis.request.onreadystatechange = function() {\n\t\tif (\n\t\t\tthis.request.readyState === this.request.DONE && \n\t\t\tthis.request.status === 200\n\t\t) {\n\t\t\tthis.onLoad(this.request.response);\n\t\t}\n\t}.bind(this);\n\n\tthis.request.onprogress = this.onProgress.bind(this);\n\tthis.request.open('GET', this.url);\n\tthis.request.responseType = \"arraybuffer\";\n\tthis.request.send();\n};\n\nAjaxSource.prototype.resume = function(secondsHeadroom) {\n\t// Nothing to do here\n};\n\nAjaxSource.prototype.destroy = function() {\n\tthis.request.abort();\n};\n\nAjaxSource.prototype.onProgress = function(ev) {\n\tthis.progress = (ev.loaded / ev.total);\n};\n\nAjaxSource.prototype.onLoad = function(data) {\n\tthis.established = true;\n\tthis.completed = true;\n\tthis.progress = 1;\n\n\tif (this.destination) {\n\t\tthis.destination.write(data);\n\t}\n};\n\nexport default AjaxSource;\n\n\n"]}